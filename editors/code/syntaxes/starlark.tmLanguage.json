{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Starlark",
  "scopeName": "source.starlark",
  "patterns": [
    { "include": "#gazelle-directives" },
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#keywords" },
    { "include": "#builtins" },
    { "include": "#bazel-rules" },
    { "include": "#function-calls" },
    { "include": "#numbers" },
    { "include": "#operators" }
  ],
  "repository": {
    "gazelle-directives": {
      "name": "comment.line.gazelle-directive.starlark",
      "match": "#\\s*(gazelle|keep|ignore):.*$",
      "captures": {
        "0": {
          "patterns": [
            {
              "name": "keyword.control.directive.starlark",
              "match": "(gazelle|keep|ignore):"
            },
            {
              "name": "entity.name.tag.directive-name.starlark",
              "match": "(?<=(gazelle|keep|ignore):)\\s*\\w+"
            }
          ]
        }
      }
    },
    "comments": {
      "patterns": [
        {
          "name": "comment.line.number-sign.starlark",
          "match": "#.*$"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.triple.starlark",
          "begin": "\"\"\"",
          "end": "\"\"\""
        },
        {
          "name": "string.quoted.triple.starlark",
          "begin": "'''",
          "end": "'''"
        },
        {
          "name": "string.quoted.double.starlark",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.starlark",
              "match": "\\\\."
            }
          ]
        },
        {
          "name": "string.quoted.single.starlark",
          "begin": "'",
          "end": "'",
          "patterns": [
            {
              "name": "constant.character.escape.starlark",
              "match": "\\\\."
            }
          ]
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.starlark",
          "match": "\\b(if|elif|else|for|in|break|continue|pass|return|def|lambda|and|or|not)\\b"
        },
        {
          "name": "constant.language.starlark",
          "match": "\\b(True|False|None)\\b"
        },
        {
          "name": "storage.type.function.starlark",
          "match": "\\b(load)\\b"
        }
      ]
    },
    "builtins": {
      "patterns": [
        {
          "name": "support.function.builtin.starlark",
          "match": "\\b(abs|all|any|bool|dict|dir|enumerate|fail|float|getattr|hasattr|hash|int|len|list|max|min|print|range|repr|reversed|sorted|str|tuple|type|zip)\\b"
        }
      ]
    },
    "bazel-rules": {
      "patterns": [
        {
          "name": "entity.name.function.rule.starlark",
          "match": "\\b(cc_library|cc_binary|cc_test|go_library|go_binary|go_test|java_library|java_binary|java_test|kt_jvm_library|kt_jvm_binary|kt_jvm_test|py_library|py_binary|py_test|proto_library|filegroup|genrule|sh_binary|sh_test|test_suite|alias|exports_files|package|package_group|licenses|load)\\b"
        },
        {
          "name": "variable.parameter.rule-attribute.starlark",
          "match": "\\b(name|srcs|deps|hdrs|data|visibility|testonly|tags|compatible_with|restricted_to|features|target_compatible_with|exec_compatible_with|toolchains|imports|copts|defines|linkopts|includes|local_defines|stamp|linkshared|linkstatic|alwayslink|implementation|attrs|outputs|executable|test|fragments|host_fragments|cfg|doc|provides|mandatory|default|allow_files|allow_single_file|allow_empty|aspects|aspect|attr|rule|repository_rule|module_extension|tag_class|providers)\\b"
        }
      ]
    },
    "function-calls": {
      "patterns": [
        {
          "name": "entity.name.function.starlark",
          "match": "\\b([a-zA-Z_][a-zA-Z0-9_]*)\\s*(?=\\()"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.starlark",
          "match": "\\b(0[xX][0-9a-fA-F]+|0[oO][0-7]+|0[bB][01]+|[0-9]+\\.?[0-9]*([eE][+-]?[0-9]+)?)\\b"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.starlark",
          "match": "(\\+|-|\\*|/|//|%|\\*\\*|==|!=|<|>|<=|>=|=|\\+=|-=|\\*=|/=|//=|%=|\\*\\*=|&|\\||\\^|~|<<|>>)"
        }
      ]
    }
  }
}
