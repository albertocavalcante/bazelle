# Bazelle - Gazelle Language Extensions
# Bazel Configuration

# ==============================================================================
# Stamping Configuration
# ==============================================================================
# Enable stamping for release builds (injects version/commit into binaries)
build --workspace_status_command=tools/scripts/workspace_status.sh

# Stamp release builds by default (use --nostamp for dev builds if needed)
build --stamp

# ==============================================================================
# Caching
# ==============================================================================
# Enable disk cache for faster rebuilds
common --disk_cache=~/.cache/bazel-disk
common --repository_cache=~/.cache/bazel-repo

# Colorize output
common --color=yes

# Show verbose failures
common --verbose_failures

# Enable isolated extension usages (required for gazelle_rust crate_universe)
common --experimental_isolated_extension_usages

# Go configuration
# CGO enabled (required for tree-sitter used by Python gazelle)
# Using host C/C++ toolchain for now (non-hermetic)
# TODO: Configure hermetic C/C++ toolchains for reproducible cross-compilation
#       See: https://github.com/aspect-build/gcc-toolchain or llvm toolchains
# build --@rules_go//go/config:pure  # DISABLED: breaks tree-sitter CGO deps

# Java configuration - use remote JDK for hermetic builds
build --java_runtime_version=remotejdk_21

# Test configuration
test --test_output=errors

# CI configuration
build:ci --announce_rc
build:ci --color=no
build:ci --curses=no
build:ci --show_timestamps
build:ci --keep_going

# ==============================================================================
# IDE Integration
# ==============================================================================
# For gopls/IDE support, set in your shell:
#   export GOPACKAGESDRIVER=$PWD/tools/gopackagesdriver.sh
#
# Or add to .envrc (if using direnv):
#   export GOPACKAGESDRIVER=$PWD/tools/gopackagesdriver.sh

# Allow user overrides
try-import %workspace%/user.bazelrc
